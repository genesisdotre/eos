<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Casa Crypto membership auction</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta property="og:title" content="Casa Crypto membership auction"/>
    <meta property="og:image" content="https://genesis.re/flower.jpg""/>
    <meta property="og:site_name" content="_____________________"/>
    <meta property="og:description" content="_____________________"/>

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@michalstefanow">
    <meta name="twitter:creator" content="@michalstefanow">
    <meta name="twitter:title" content="Casa Crypto membership auction">
    <meta name="twitter:description" content="_____________________">
    <meta name="twitter:image" content="https://genesis.re/flower.jpg">

    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> -->

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/css/bootstrap.min.css" integrity="sha384-Smlep5jCw/wG7hdkwQ/Z5nLIefveQRIY9nfy6xoR1uRYBtpZgI6339F5dgvm/e9B" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script> 
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular-route.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js" integrity="sha256-CutOzxCRucUsn6C6TcEYsauvvYilEniTXldPa6/wu0k=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-moment/1.2.0/angular-moment.min.js"></script>
    <link rel="stylesheet" href="styles.css">

    <!-- 
      this may seem redundant, as Web3 can be injected by MetaMask BUT in case of no MetaMask no simple way including it, see also:
        * https://stackoverflow.com/questions/8085111/how-to-include-a-remote-javascript-file-conditionally
        * https://stackoverflow.com/questions/14783046/using-getscript-synchronously
    -->

    <!-- <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@0.20.6/dist/web3.min.js"></script> -->

    <!-- <script charset="utf-8" src="https://cdn.ethers.io/scripts/ethers-v4.js" type="text/javascript"></script> -->
    <script charset="utf-8" src="lib/ethers.js" type="text/javascript"></script>

    <link rel='shortcut icon' href='favicon.ico' type='image/x-icon' /> <!-- required for MetaMask https://ethereum.stackexchange.com/questions/64979/how-do-you-set-an-icon-for-metamask-dapp-connect-popup-prompt -->


  </head>
  <body ng-app="app" ng-controller="ctrl" ng-cloak>
  
      <div class="container">

        <span>
          <h1>{{ message }}</h1>

          <h3><input readonly="" class="address" value="{{ address }}"></h3>
          
          <h4>Summary of the auction:</h4>

          <strong>Deployed to <a href="https://ropsten.etherscan.io/address/{{ address }}#code">Ropsten</a> (testnet)</strong><br>
          <strong>Auction ends:</strong> {{ timestampEnd | amFromUnix | amDateFormat:'ddd, MMM Do YYYY, h:mm:ss a'}}<br>
          <strong>Starting price:</strong> {{ price.toFixed(2) }} ETH<br>
          <strong>How many initially for sale:</strong> {{ howMany + howManyGuaranteed }}<br>
          <strong>How many left:</strong> {{ howMany }} ({{ guaranteedSold }} guaranteed sold) <br>
          <strong>How many guaranteed left:</strong> {{ howManyGuaranteed }}<br>
          <strong>Guaranteed price:</strong> {{ priceGuaranteed.toFixed(2) }} ETH<br>
        
        

          <h4>Current bids</h4>
          <table class="table table-sm table-bordered">
            <tr>
              <th class="index"></th>
              <th>account</th>
              <th class="micro">bid</th>
            </tr>
            <tr ng-repeat="account in accounts| orderBy:'value':true">
              <td class="index">{{ $index + 1 }}.</td>
              <td>{{ account.bidder }}</td>
              <td class="micro">{{ account.value.toFixed(2) }}</td>
            </tr>
          </table>        

          <h4>Guaranteed bids</h4>
          <table class="table table-sm table-bordered">
            <tr>
              <th class="index"></th>
              <th>account</th>
              <th class="micro">bid</th>
            </tr>
            <tr ng-repeat="bid in guranteedBids">
              <td class="index">{{ $index + 1 }}.</td>
              <td>{{ bid.bidder }}</td>
              <td class="micro">{{ bid.value.toFixed(2) }}</td>
            </tr>
          </table>   

          <span ng-show="$root.metamask">

            <h4>All the incoming transactions</h4>
            <p style="margin-bottom: 0">Includes multiple bids from the same account and bids already refunded (withdrawn)</p> 
            <table class="table table-sm table-bordered">
              <tr>
                <th class="index"></th>
                <th>account</th>
                <th class="micro">bid</th>
                <th class="timestamp">timestamp</th>
                <th class="narrow">tx</th>
              </tr>
              <tr ng-repeat="bid in bids| orderBy:'timestamp':true">
                <td class="index">{{ $index + 1 }}.</td>
                <td>{{ bid.bidder }}</td>
                <td class="micro">{{ bid.value.toFixed(2) }}</td>
                <td class="timestamp"><span am-time-ago="bid.timestamp | amFromUnix"></span></td>
                <td class="narrow"><a href="https://ropsten.etherscan.io/tx/{{ bid.tx }}" title="{{ bid.tx }}">{{ bid.tx }}</a></td>
          
              </tr>
            </table>          

            <h4>Refunds (witdrawn)</h4>
            <table class="table table-sm table-bordered">
              <tr>
                <th class="index"></th>
                <th>account</th>
                <th class="micro">bid</th>
                <th class="timestamp">timestamp</th>
                <th class="narrow">tx</th>
              </tr>
              <tr ng-repeat="bid in refunds">
                <td class="index">{{ $index + 1 }}.</td>
                <td>{{ bid.bidder }}</td>
                <td class="micro">{{ bid.value.toFixed(2) }}</td>
                <td class="timestamp"><span am-time-ago="bid.timestamp | amFromUnix"></span></td>
                <td class="narrow"><a href="https://ropsten.etherscan.io/tx/{{ bid.tx }}" title="{{ bid.tx }}">{{ bid.tx }}</a></td>
              </tr>
            </table>
          </span>

          <span ng-show="! $root.metamask">
            <h3>Metamask required to obtain more data</h3>
            <p>See <a href="https://github.com/INFURA/infura/issues/13#issuecomment-405077145">this</a> and <a href="https://github.com/INFURA/infura/issues/73#issuecomment-405078968">that</a> GitHub issue. I'm not the smartest, not the most experienced Ethereum programmer on this planet and I've wasted (invested) enough time trying to get it to work. Just install <a href="https://metamask.io/">MetaMask</a> babe for full functionality, can you imagine, we are still in technology early days, internet in 1996.</p>
            <img src="images/metamask.jpg">
          </span>

        </span>
        <!-- <span ng-show="! $root.ropsten">
          <h1 style="font-family: monospace; font-weight: bold; border: 5px solid black; padding: 10px; margin-top: .5rem; margin-bottom: 20px;">please switch to the Ropsten testnet</h1>
          <img src="images/metamask.jpg" style="border: 5px solid gray; width: 100%; max-width: 100%;">
        </span> -->

      </div>
    </div>

     <script src="app.js"></script>

     <!-- <script>document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=1"></' + 'script>')</script> -->

  </body>
</html>

